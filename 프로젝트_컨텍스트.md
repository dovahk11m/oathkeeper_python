# Oathkeeper Python AI 서버 - 프로젝트 컨텍스트

> 새 대화에서 작업 재개를 위한 빠른 참조 문서

---

## 🔥 최근 변경사항

**마지막 업데이트:** 2025-11-25

### v2 API 통합 완료 ✨

- **변경:** 2개 API → 1개 통합 (`POST /metrics/group/summary`)
- **삭제:** `/metrics/group/summary/text` 엔드포인트
- **응답:** `{group_summary: {...}, text_summary: "..."}`
- **상태:** 구현 완료, 미커밋

### Git 상태

```bash
# 커밋됨 (2025-11-24): v1 코드
# 미커밋: v2 수정 (models.py, group.py, group_service.py)
```

**참조 문서:**

- [1125*API_v2*구현완료\_회신.md](file:///c:/workspace/oathkeeper_python/docs/1125_API_v2_구현완료_회신.md) - Java 팀 전달용
- [PYTHON_API_REQ.md](file:///c:/workspace/oathkeeper_python/docs/PYTHON_API_REQ.md) - v2 요구사항

---

## 📋 프로젝트 개요

**목적:** 그룹(채팅방) 메트릭 통계 및 자연어 요약 제공  
**기술 스택:** Python 3.11 + FastAPI + Ollama LLM  
**클라이언트:** Spring 서버  
**서버:** `http://localhost:8001`

---

## 📁 주요 파일 구조

```
c:\workspace\oathkeeper_python\
├── app/
│   ├── main.py                    # FastAPI 진입점
│   ├── models.py                  # Pydantic 모델 (v2 수정됨)
│   ├── routers/group.py           # API 엔드포인트 (v2 수정됨)
│   └── services/group_service.py  # 비즈니스 로직 (v2 수정됨)
├── docs/
│   ├── PYTHON_API_REQ.md                # v2 요구사항 명세
│   ├── 1125_API_v2_구현완료_회신.md     # Java 팀 회신
│   ├── 1125_파이썬API작업계획.md        # v2 작업 계획
│   └── 1124_파이썬API작업기록.md        # v1 작업 기록
└── data/plan_{id}/metrics.jsonl   # 메트릭 데이터 (JSONL)
```

---

## 🔑 핵심 API (v2)

### Endpoint

```
POST /metrics/group/summary
```

### 요청

```json
{
  "plan_ids": [1, 2],
  "style": "친근한 톤으로",
  "notes": "긍정적인 면 강조",
  "mode": "llm" // "rules" | "llm"
}
```

### 응답

```json
{
  "success": true,
  "data": {
    "group_summary": {
      "total_plans_analyzed": 2,
      "total_records": 50,
      "total_distance_km": 120.5,
      ...
    },
    "text_summary": "분석된 2개의 약속에 따르면..."
  },
  "warnings": null
}
```

**에러 처리:**

- 일부 실패: `200 OK` + `warnings` 배열
- 전체 실패: `409 Conflict`

---

## 🚀 빠른 시작 (새 대화용)

새 대화에서 이렇게 시작하세요:

```
"Oathkeeper Python AI 서버 프로젝트야.
@프로젝트_컨텍스트.md 참고해서 작업 이어가자.

v2 API 방금 구현 완료했고,
다음 작업: [여기에 요청사항 작성]"
```

또는:

```
"@docs/1125_API_v2_구현완료_회신.md 이 문서 기준으로 작업 중.
[요청사항]"
```

---

## 📚 필수 참조

1. **API 구현:** `@app/routers/group.py`
2. **비즈니스 로직:** `@app/services/group_service.py`
3. **모델 정의:** `@app/models.py`
4. **최신 명세:** `@docs/1125_API_v2_구현완료_회신.md`

---

## 💡 주요 변경 히스토리

| 날짜       | 버전 | 변경 내용                |
| ---------- | ---- | ------------------------ |
| 2025-11-25 | v2   | API 통합 (2개 → 1개)     |
| 2025-11-24 | v1   | 초기 구현 (2개 분리 API) |

---

**작성일:** 2025-11-25  
**다음 작업:** Git commit + Java 팀 알림
