# Python AI ì„œë²„ API v2 êµ¬í˜„ ì™„ë£Œ íšŒì‹ 

**ë²„ì „:** v2.0  
**ì‘ì„±ì¼:** 2025-11-25  
**ì‘ì„±ì:** Python AI ì„œë²„ ê°œë°œíŒ€  
**ì°¸ì¡° ë¬¸ì„œ:** [PYTHON_API_REQ.md (v2)](file:///c:/workspace/oathkeeper_python/docs/PYTHON_API_REQ.md)

## ëª©ì°¨

- [êµ¬í˜„ ìƒíƒœ](#êµ¬í˜„-ìƒíƒœ)
- [ë³€ê²½ì‚¬í•­ ìš”ì•½](#ë³€ê²½ì‚¬í•­-ìš”ì•½)
- [API ëª…ì„¸](#api-ëª…ì„¸)
- [ìš”ì²­/ì‘ë‹µ ì˜ˆì‹œ](#ìš”ì²­ì‘ë‹µ-ì˜ˆì‹œ)
- [ì˜¤ë¥˜ ì²˜ë¦¬](#ì˜¤ë¥˜-ì²˜ë¦¬)
- [Java/Spring ì—°ë™ ê°€ì´ë“œ](#java-spring-ì—°ë™-ê°€ì´ë“œ)
- [í…ŒìŠ¤íŠ¸ ë°©ë²•](#í…ŒìŠ¤íŠ¸-ë°©ë²•)
- [FAQ](#faq)
- [ë¬¸ì˜ì‚¬í•­](#ë¬¸ì˜ì‚¬í•­)

---

## âœ… êµ¬í˜„ ìƒíƒœ

### ìš”ì²­ì‚¬í•­ ê²€í†  ê²°ê³¼

v2 ëª…ì„¸ì— ë”°ë¼ **ê·¸ë£¹ í†µí•© ìš”ì•½ API** êµ¬í˜„ì„ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.

| í•­ëª©                 | ìƒíƒœ    | ë¹„ê³                                       |
| -------------------- | ------- | ----------------------------------------- |
| API í†µí•© (2ê°œ â†’ 1ê°œ) | âœ… ì™„ë£Œ | `/metrics/group/summary` ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸  |
| ê°œë³„ í”Œëœ ìš”ì•½ API   | âœ… ì™„ë£Œ | `/metrics/plan/{plan_id}/summary` ì¶”ê°€    |
| ìš”ì²­ íŒŒë¼ë¯¸í„° ì¶”ê°€   | âœ… ì™„ë£Œ | `style`, `notes` í•„ë“œ ì¶”ê°€                |
| ì‘ë‹µ êµ¬ì¡° ë³€ê²½       | âœ… ì™„ë£Œ | `group_summary` + `text_summary` í†µí•©     |
| ì—ëŸ¬ ì²˜ë¦¬            | âœ… ì™„ë£Œ | ë¶€ë¶„ ì„±ê³µ(200 + warnings), ì „ì²´ ì‹¤íŒ¨(409) |
| í…ŒìŠ¤íŠ¸ ì™„ë£Œ          | âœ… ì™„ë£Œ | ì •ìƒ/ê²½ê³ /ì—ëŸ¬ ì¼€ì´ìŠ¤ ê²€ì¦                |

---

## ğŸ“‹ ë³€ê²½ì‚¬í•­ ìš”ì•½

### v1 â†’ v2 ì£¼ìš” ë³€ê²½

```mermaid
graph LR
    A[v1: 2ê°œ API] --> B[v2: 1ê°œ í†µí•© API]

    subgraph "v1 (ê¸°ì¡´)"
        C[POST /metrics/group/summary<br/>â†’ í†µê³„ë§Œ]
        D[POST /metrics/group/summary/text<br/>â†’ í…ìŠ¤íŠ¸ë§Œ]
    end

    subgraph "v2 (ë³€ê²½)"
        E[POST /metrics/group/summary<br/>â†’ í†µê³„ + í…ìŠ¤íŠ¸]
    end

    A --> C
    A --> D
    B --> E
```

### ë³€ê²½ ì„¸ë¶€ì‚¬í•­

| êµ¬ë¶„           | v1                                                                          | v2                                                              |
| -------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **ì—”ë“œí¬ì¸íŠ¸** | 2ê°œ ë¶„ë¦¬<br/>- `/metrics/group/summary`<br/>- `/metrics/group/summary/text` | 1ê°œ í†µí•©<br/>- `/metrics/group/summary`                         |
| **ìš”ì²­ í•„ë“œ**  | `plan_ids`                                                                  | `plan_ids`, `style`, `notes`, `mode`                            |
| **ì‘ë‹µ êµ¬ì¡°**  | `{ "data": { í†µê³„ í•„ë“œë“¤... } }`                                            | `{ "data": { "group_summary": {...}, "text_summary": "..." } }` |
| **í˜¸ì¶œ íšŸìˆ˜**  | 2íšŒ (í†µê³„ + í…ìŠ¤íŠ¸)                                                         | 1íšŒ (í†µí•©)                                                      |

---

## ğŸ”§ API ëª…ì„¸

### 1. ê·¸ë£¹ í†µí•© ìš”ì•½ (Group Summary)

#### Endpoint

```
POST /metrics/group/summary
```

### ìš”ì²­ í˜•ì‹

**Content-Type:** `application/json`

```json
{
  "plan_ids": [1, 5, 12, 23],
  "style": "ë°ì´í„° ë¶„ì„ê°€ì²˜ëŸ¼ ê°ê´€ì ì¸ í†¤ìœ¼ë¡œ",
  "notes": "ì§€ê° ë¹ˆë„ê°€ ë†’ì€ ê²½í–¥ì´ ìˆëŠ”ì§€ ë¶„ì„í•´ì£¼ì„¸ìš”.",
  "mode": "llm"
}
```

#### í•„ë“œ ì„¤ëª…

| í•„ë“œ       | íƒ€ì…             | í•„ìˆ˜    | ê¸°ë³¸ê°’  | ì„¤ëª…                                |
| ---------- | ---------------- | ------- | ------- | ----------------------------------- |
| `plan_ids` | `array<integer>` | âœ… í•„ìˆ˜ | -       | ë¶„ì„í•  plan_id ëª©ë¡ (ìµœì†Œ 1ê°œ)      |
| `style`    | `string`         | ì„ íƒ    | `""`    | í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ (ì˜ˆ: "ì¹œê·¼í•œ í†¤ìœ¼ë¡œ") |
| `notes`    | `string`         | ì„ íƒ    | `""`    | ì¶”ê°€ ìš”ì²­ì‚¬í•­                       |
| `mode`     | `string`         | ì„ íƒ    | `"llm"` | ìƒì„± ëª¨ë“œ: `"rules"` or `"llm"`     |

---

### ì‘ë‹µ í˜•ì‹

#### ì •ìƒ ì‘ë‹µ (200 OK)

```json
{
  "success": true,
  "data": {
    "group_summary": {
      "total_plans_analyzed": 4,
      "total_records": 128,
      "total_distance_km": 258.4,
      "avg_distance_per_plan_km": 64.6,
      "total_travel_minutes": 450,
      "avg_travel_minutes_per_plan": 112.5,
      "total_late_minutes": 45,
      "avg_late_minutes_per_plan": 11.25,
      "total_wait_minutes": 20,
      "avg_wait_minutes_per_plan": 5.0
    },
    "text_summary": "ë¶„ì„ëœ 4ê°œì˜ ì•½ì†ì— ë”°ë¥´ë©´, ì´ ê·¸ë£¹ì€ ì•½ì†ë‹¹ í‰ê·  64.6kmë¥¼ ì´ë™í–ˆìœ¼ë©°, í‰ê·  11.25ë¶„ì˜ ì§€ê° ì‹œê°„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. ì „ë°˜ì ìœ¼ë¡œ ì¥ê±°ë¦¬ ì´ë™ì´ ì¦ê³ , ì•½ì† ì‹œê°„ì„ ì¤€ìˆ˜í•˜ëŠ” ë° ì•½ê°„ì˜ ì–´ë ¤ì›€ì´ ìˆëŠ” ê²½í–¥ì„ ë³´ì…ë‹ˆë‹¤."
  },
  "warnings": null
}
```

#### ë¶€ë¶„ ì„±ê³µ ì‘ë‹µ (200 OK + warnings)

ì¼ë¶€ plan_idì— ë¬¸ì œê°€ ìˆëŠ” ê²½ìš°:

```json
{
  "success": true,
  "data": {
    "group_summary": {
      "total_plans_analyzed": 3,
      "total_records": 96,
      ...
    },
    "text_summary": "ë¶„ì„ëœ 3ê°œì˜ ì•½ì†ì— ë”°ë¥´ë©´..."
  },
  "warnings": [
    "plan_id '15' was not found.",
    "plan_id '23' has no metrics data."
  ]
}
```

#### ì „ì²´ ì‹¤íŒ¨ ì‘ë‹µ (409 Conflict)

ëª¨ë“  plan_idì— ë¬¸ì œê°€ ìˆëŠ” ê²½ìš°:

```json
{
  "success": false,
  "data": null,
  "message": "No data available for the given plan_ids."
}
```

---

### 2. ê°œë³„ í”Œëœ ìš”ì•½ (Individual Plan Summary)

#### Endpoint

```
POST /metrics/plan/{plan_id}/summary
```

#### ìš”ì²­ í˜•ì‹

- **Path Parameter**: `plan_id` (integer, required)
- **Body**: ì—†ìŒ

#### ì‘ë‹µ í˜•ì‹

**ì •ìƒ ì‘ë‹µ (200 OK)**

```json
{
  "success": true,
  "data": {
    "plan_id": 2,
    "text_summary": "ì•½ì† #2ì˜ ìš”ì•½ì…ë‹ˆë‹¤. ì´ ì´ë™ ê±°ë¦¬ëŠ” 23.63km, ì´ ì´ë™ ì‹œê°„ì€ 200ë¶„ì´ì—ˆìŠµë‹ˆë‹¤..."
  }
}
```

**ì‹¤íŒ¨ ì‘ë‹µ (409 Conflict)**

- í•´ë‹¹ Planì— ëŒ€í•œ ë©”íŠ¸ë¦­ ë°ì´í„°ê°€ ì—†ê±°ë‚˜, ì•„ì§ ì¢…ë£Œë˜ì§€ ì•Šì•„ ìš”ì•½í•  ìˆ˜ ì—†ëŠ” ê²½ìš°

```json
{
  "detail": {
    "code": "NOT_READY",
    "message": "Plan not finished or no metrics yet."
  }
}
```

---

## â˜• Java/Spring ì—°ë™ ê°€ì´ë“œ

### 1. DTO í´ë˜ìŠ¤ ìˆ˜ì •

#### ê¸°ì¡´ v1 í´ë˜ìŠ¤ ì‚­ì œ/í†µí•©

```java
// âŒ ì‚­ì œ: GroupTextSummaryRequest.java
// âŒ ì‚­ì œ: GroupTextSummaryResponse.java
```

#### ìˆ˜ì •: GroupSummaryRequest.java

```java
package com.oathkeeper.dto.request;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import javax.validation.constraints.NotEmpty;
import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class GroupSummaryRequest {

    @NotEmpty(message = "plan_idsëŠ” ìµœì†Œ 1ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤")
    private List<Long> planIds;

    // âœ¨ v2 ì‹ ê·œ í•„ë“œ
    @Builder.Default
    private String style = "";

    @Builder.Default
    private String notes = "";

    @Builder.Default
    private String mode = "llm";  // "rules" | "llm"
}
```

#### ì‹ ê·œ: GroupSummaryStats.java

```java
package com.oathkeeper.dto.response;

import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class GroupSummaryStats {

    @JsonProperty("total_plans_analyzed")
    private Integer totalPlansAnalyzed;

    @JsonProperty("total_records")
    private Integer totalRecords;

    @JsonProperty("total_distance_km")
    private Double totalDistanceKm;

    @JsonProperty("avg_distance_per_plan_km")
    private Double avgDistancePerPlanKm;

    @JsonProperty("total_travel_minutes")
    private Integer totalTravelMinutes;

    @JsonProperty("avg_travel_minutes_per_plan")
    private Double avgTravelMinutesPerPlan;

    @JsonProperty("total_late_minutes")
    private Integer totalLateMinutes;

    @JsonProperty("avg_late_minutes_per_plan")
    private Double avgLateMinutesPerPlan;

    @JsonProperty("total_wait_minutes")
    private Integer totalWaitMinutes;

    @JsonProperty("avg_wait_minutes_per_plan")
    private Double avgWaitMinutesPerPlan;
}
```

#### ìˆ˜ì •: GroupSummaryResponse.java

```java
package com.oathkeeper.dto.response;

import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class GroupSummaryResponse {

    private Boolean success;
    private GroupSummaryData data;  // âœ¨ êµ¬ì¡° ë³€ê²½
    private List<String> warnings;

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class GroupSummaryData {

        @JsonProperty("group_summary")
        private GroupSummaryStats groupSummary;  // âœ¨ í†µê³„ ë°ì´í„°

        @JsonProperty("text_summary")
        private String textSummary;  // âœ¨ ìì—°ì–´ ìš”ì•½
    }
}
```

---

### 2. Service í´ë˜ìŠ¤ ìˆ˜ì •

#### PythonAiClient.java

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class PythonAiClient {

    private final RestTemplate restTemplate;

    @Value("${python.ai.base-url:http://localhost:8001}")
    private String pythonAiBaseUrl;

    /**
     * ê·¸ë£¹ í†µí•© ìš”ì•½ ì¡°íšŒ (v2: í†µê³„ + í…ìŠ¤íŠ¸)
     *
     * @param planIds ë¶„ì„í•  plan_id ëª©ë¡
     * @param style í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ (ì„ íƒ)
     * @param notes ì¶”ê°€ ìš”ì²­ì‚¬í•­ (ì„ íƒ)
     * @param mode ìƒì„± ëª¨ë“œ (ì„ íƒ, ê¸°ë³¸ê°’: "llm")
     * @return ê·¸ë£¹ í†µê³„ + ìì—°ì–´ ìš”ì•½
     */
    public GroupSummaryResponse getGroupSummary(
            List<Long> planIds,
            String style,
            String notes,
            String mode
    ) {
        String url = pythonAiBaseUrl + "/metrics/group/summary";

        GroupSummaryRequest request = GroupSummaryRequest.builder()
                .planIds(planIds)
                .style(style != null ? style : "")
                .notes(notes != null ? notes : "")
                .mode(mode != null ? mode : "llm")
                .build();

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity<GroupSummaryRequest> entity = new HttpEntity<>(request, headers);

        try {
            ResponseEntity<GroupSummaryResponse> response = restTemplate.exchange(
                    url,
                    HttpMethod.POST,
                    entity,
                    GroupSummaryResponse.class
            );

            GroupSummaryResponse body = response.getBody();

            // warnings ë¡œê¹…
            if (body != null && body.getWarnings() != null && !body.getWarnings().isEmpty()) {
                log.warn("ê·¸ë£¹ ìš”ì•½ ì¡°íšŒ ì‹œ ê²½ê³ : {}", body.getWarnings());
            }

            return body;

        } catch (HttpClientErrorException.Conflict e) {
            log.error("ê·¸ë£¹ ìš”ì•½ ì¡°íšŒ ì‹¤íŒ¨ - ë°ì´í„° ì—†ìŒ: planIds={}", planIds);
            throw new PythonAiException("ë¶„ì„ ê°€ëŠ¥í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤", e);

        } catch (Exception e) {
            log.error("ê·¸ë£¹ ìš”ì•½ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: planIds={}", planIds, e);
            throw new PythonAiException("Python AI ì„œë²„ í†µì‹  ì‹¤íŒ¨", e);
        }
    }

    /**
     * ê°„í¸ ë©”ì„œë“œ: ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ê·¸ë£¹ ìš”ì•½ ì¡°íšŒ
     */
    public GroupSummaryResponse getGroupSummarySimple(List<Long> planIds) {
        return getGroupSummary(planIds, null, null, "rules");  // rules ëª¨ë“œë¡œ ë¹ ë¥¸ ì‘ë‹µ
    }
}
```

---

### 3. ì‚¬ìš© ì˜ˆì œ

#### ì˜ˆì œ 1: ê¸°ë³¸ ì‚¬ìš©

```java
@Service
@RequiredArgsConstructor
public class ChatRoomService {

    private final PythonAiClient pythonAiClient;

    public ChatRoomStatistics getChatRoomStatistics(Long chatRoomId) {
        List<Long> planIds = getPlanIds(chatRoomId);

        // v2 API í˜¸ì¶œ (í†µê³„ + í…ìŠ¤íŠ¸ í•œ ë²ˆì—)
        GroupSummaryResponse response = pythonAiClient.getGroupSummary(
                planIds,
                "ì¹œê·¼í•œ í†¤ìœ¼ë¡œ",
                "ê¸ì •ì ì¸ ë©´ì„ ê°•ì¡°í•´ì£¼ì„¸ìš”",
                "llm"
        );

        // í†µê³„ ë°ì´í„° ì ‘ê·¼
        GroupSummaryStats stats = response.getData().getGroupSummary();
        log.info("ì´ ì•½ì† ìˆ˜: {}", stats.getTotalPlansAnalyzed());

        // ìì—°ì–´ ìš”ì•½ ì ‘ê·¼
        String summary = response.getData().getTextSummary();
        log.info("ìš”ì•½: {}", summary);

        return ChatRoomStatistics.from(stats, summary);
    }
}
```

#### ì˜ˆì œ 2: ë¹ ë¥¸ ì‘ë‹µ (rules ëª¨ë“œ)

```java
// LLM ì—†ì´ ë¹ ë¥¸ ì‘ë‹µ (1~2ì´ˆ ì´ë‚´)
GroupSummaryResponse response = pythonAiClient.getGroupSummary(
        planIds,
        "",      // style ì—†ìŒ
        "",      // notes ì—†ìŒ
        "rules"  // rules ëª¨ë“œ
);
```

#### ì˜ˆì œ 3: ìƒì„¸ ë¶„ì„ (llm ëª¨ë“œ)

```java
// LLMìœ¼ë¡œ ìƒì„¸ ë¶„ì„ (5~30ì´ˆ ì†Œìš”)
GroupSummaryResponse response = pythonAiClient.getGroupSummary(
        planIds,
        "ë°ì´í„° ë¶„ì„ê°€ì²˜ëŸ¼ ê°ê´€ì ì¸ í†¤ìœ¼ë¡œ",
        "ì§€ê° ë¹ˆë„ê°€ ë†’ì€ ê²½í–¥ì´ ìˆëŠ”ì§€ ë¶„ì„í•´ì£¼ì„¸ìš”",
        "llm"
);
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. í•˜ìœ„ í˜¸í™˜ì„±

> **ì¤‘ìš”:** v1 API(`/metrics/group/summary/text`)ëŠ” **ì‚­ì œ**ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì˜í–¥:**

- ê¸°ì¡´ v1 APIë¥¼ ì‚¬ìš© ì¤‘ì¸ ì½”ë“œëŠ” **ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**
- v2 APIë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”

**ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ:**

```java
// âŒ v1 (ë™ì‘ ì•ˆ í•¨)
GroupSummaryResponse statsResponse = client.getGroupSummary(planIds);
GroupTextSummaryResponse textResponse = client.getGroupSummaryText(planIds, style, notes);

// âœ… v2 (í•œ ë²ˆì˜ í˜¸ì¶œ)
GroupSummaryResponse response = client.getGroupSummary(planIds, style, notes, "llm");
GroupSummaryStats stats = response.getData().getGroupSummary();
String text = response.getData().getTextSummary();
```

---

### 2. ì‘ë‹µ ì‹œê°„

| ëª¨ë“œ    | ì˜ˆìƒ ì‘ë‹µ ì‹œê°„ | ê¶Œì¥ ì‚¬ìš©ì²˜                    |
| ------- | -------------- | ------------------------------ |
| `rules` | 1~2ì´ˆ          | ì‹¤ì‹œê°„ ì¡°íšŒ, ë¹ ë¥¸ ì‘ë‹µ í•„ìš” ì‹œ |
| `llm`   | 5~30ì´ˆ         | ìƒì„¸ ë¶„ì„, ë¹„ë™ê¸° ì²˜ë¦¬         |

**ê¶Œì¥:**

- ì‚¬ìš©ì ëŒ€ë©´ API: `mode="rules"` (ë¹ ë¥¸ ì‘ë‹µ)
- ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…: `mode="llm"` (ìƒì„¸ ë¶„ì„)

---

### 3. Timeout ì„¤ì •

```java
@Configuration
public class RestTemplateConfig {

    @Bean
    public RestTemplate restTemplate(RestTemplateBuilder builder) {
        return builder
                .setConnectTimeout(Duration.ofSeconds(5))
                .setReadTimeout(Duration.ofSeconds(35))  // âœ¨ LLM ëª¨ë“œ ê³ ë ¤
                .build();
    }
}
```

---

### 4. ì‘ë‹µ ë°ì´í„° ì ‘ê·¼ ë°©ë²• ë³€ê²½

```java
// âŒ v1
Integer totalPlans = response.getData().getTotalPlansAnalyzed();

// âœ… v2
Integer totalPlans = response.getData().getGroupSummary().getTotalPlansAnalyzed();
String summary = response.getData().getTextSummary();
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. Swagger UI

ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†:

```
http://localhost:8001/docs
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**

1. `POST /metrics/group/summary` ì„ íƒ
2. "Try it out" í´ë¦­
3. ìš”ì²­ Body ì…ë ¥:

```json
{
  "plan_ids": [1, 2],
  "style": "ì¹œê·¼í•œ í†¤ìœ¼ë¡œ",
  "notes": "ê¸ì •ì ì¸ ë©´ì„ ê°•ì¡°í•´ì£¼ì„¸ìš”",
  "mode": "rules"
}
```

4. "Execute" í´ë¦­
5. ì‘ë‹µ í™•ì¸

---

### 2. curl í…ŒìŠ¤íŠ¸

```bash
curl -X POST "http://localhost:8001/metrics/group/summary" \
  -H "Content-Type: application/json" \
  -d '{
    "plan_ids": [1, 2],
    "style": "ì¹œê·¼í•œ í†¤ìœ¼ë¡œ",
    "notes": "ê¸ì •ì ì¸ ë©´ì„ ê°•ì¡°í•´ì£¼ì„¸ìš”",
    "mode": "llm"
  }'
```

---

### 3. Java í†µí•© í…ŒìŠ¤íŠ¸

```java
@SpringBootTest
class PythonAiClientTest {

    @Autowired
    private PythonAiClient pythonAiClient;

    @Test
    void testGetGroupSummary_v2() {
        // Given
        List<Long> planIds = Arrays.asList(1L, 2L);

        // When
        GroupSummaryResponse response = pythonAiClient.getGroupSummary(
                planIds,
                "ì¹œê·¼í•œ í†¤ìœ¼ë¡œ",
                "ê¸ì •ì ì¸ ë©´ì„ ê°•ì¡°í•´ì£¼ì„¸ìš”",
                "rules"
        );

        // Then
        assertThat(response.getSuccess()).isTrue();
        assertThat(response.getData()).isNotNull();

        // í†µê³„ ë°ì´í„° ê²€ì¦
        GroupSummaryStats stats = response.getData().getGroupSummary();
        assertThat(stats.getTotalPlansAnalyzed()).isEqualTo(2);
        assertThat(stats.getTotalRecords()).isGreaterThan(0);

        // í…ìŠ¤íŠ¸ ìš”ì•½ ê²€ì¦
        String text = response.getData().getTextSummary();
        assertThat(text).isNotBlank();
        assertThat(text).contains("ì•½ì†");
    }
}
```

---

## ğŸ“Š ë³€ê²½ ì˜í–¥ë„ ë¶„ì„

### ì˜í–¥ì„ ë°›ëŠ” ë¶€ë¶„

| ì˜ì—­           | ì˜í–¥ë„ | ìˆ˜ì • í•„ìš”            |
| -------------- | ------ | -------------------- |
| DTO í´ë˜ìŠ¤     | ë†’ìŒ   | âœ… í•„ìˆ˜              |
| Service í´ë˜ìŠ¤ | ì¤‘ê°„   | âœ… í•„ìˆ˜              |
| Controller     | ì¤‘ê°„   | âœ… í•„ìˆ˜ (v1 ì‚¬ìš© ì‹œ) |
| DB ìŠ¤í‚¤ë§ˆ      | ì—†ìŒ   | âŒ ë¶ˆí•„ìš”            |
| í”„ë¡ íŠ¸ì—”ë“œ     | ì¤‘ê°„   | âš ï¸ v1 ì‚¬ìš© í™•ì¸ í•„ìš” |

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `GroupSummaryRequest`ì— `style`, `notes`, `mode` í•„ë“œ ì¶”ê°€
- [ ] `GroupSummaryStats` í´ë˜ìŠ¤ ìƒì„±
- [ ] `GroupSummaryResponse.GroupSummaryData` êµ¬ì¡° ë³€ê²½
- [ ] `GroupTextSummaryRequest`, `GroupTextSummaryResponse` ì‚­ì œ
- [ ] `PythonAiClient.getGroupSummary()` ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
- [ ] `getGroupSummaryText()` ë©”ì„œë“œ ì‚­ì œ (í†µí•©ë¨)
- [ ] ê¸°ì¡´ v1 í˜¸ì¶œ ì½”ë“œ v2ë¡œ ë³€ê²½
- [ ] Timeout ì„¤ì • í™•ì¸ (ìµœì†Œ 35ì´ˆ)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰

---

## ğŸ’¡ FAQ

### Q1. v1 APIëŠ” ì–¸ì œê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•œê°€ìš”?

**A:** v1 API(`/metrics/group/summary/text`)ëŠ” **ì¦‰ì‹œ ì œê±°**ë˜ì—ˆìŠµë‹ˆë‹¤. v2ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”í•©ë‹ˆë‹¤.

### Q2. ì‘ë‹µ ì‹œê°„ì´ ë„ˆë¬´ ëŠë¦°ë°ìš”?

**A:** `mode="llm"` ì‚¬ìš© ì‹œ 5~30ì´ˆ ì†Œìš”ë©ë‹ˆë‹¤. ë¹ ë¥¸ ì‘ë‹µì´ í•„ìš”í•˜ë©´ `mode="rules"` ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

### Q3. styleê³¼ notesë¥¼ ìƒëµí•´ë„ ë˜ë‚˜ìš”?

**A:** ë„¤, ì„ íƒ í•„ë“œì…ë‹ˆë‹¤. ê¸°ë³¸ê°’(`""`)ìœ¼ë¡œ ë™ì‘í•˜ë©°, modeê°€ `"rules"`ì¸ ê²½ìš° ë¬´ì‹œë©ë‹ˆë‹¤.

### Q4. warningsê°€ ìˆìœ¼ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ë‚˜ìš”?

**A:** ì¼ë¶€ plan_idê°€ ì‹¤íŒ¨í•´ë„ `200 OK`ê°€ ë°˜í™˜ë©ë‹ˆë‹¤. `warnings` ë°°ì—´ì„ í™•ì¸í•˜ì—¬ ë¡œê·¸ì— ê¸°ë¡í•˜ê³ , ê°€ëŠ¥í•œ ë°ì´í„°ë§Œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

### Q5. 409 ConflictëŠ” ì–¸ì œ ë°œìƒí•˜ë‚˜ìš”?

**A:** **ëª¨ë“ ** plan_idì— ë¬¸ì œê°€ ìˆì–´ ë¶„ì„í•  ë°ì´í„°ê°€ ì „í˜€ ì—†ì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

---

## ğŸ“ ë¬¸ì˜ì‚¬í•­

êµ¬í˜„ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ Python AI ì„œë²„ ê°œë°œíŒ€ìœ¼ë¡œ ì—°ë½ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

**êµ¬í˜„ ì™„ë£Œì¼:** 2025-11-25  
**ì„œë²„ ìƒíƒœ:** âœ… ì •ìƒ ìš´ì˜ ì¤‘  
**ì—”ë“œí¬ì¸íŠ¸:** `http://localhost:8001/metrics/group/summary`

## ğŸš¨ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

- **404 Not Found** ê°€ ë°œìƒí•œë‹¤ë©´ ìš”ì²­ URLì´ `/metrics/group/summary` ë¡œ ì •í™•íˆ ì§€ì •ë˜ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
  - FastAPI ë¼ìš°í„°ëŠ” `app.include_router(group_router, prefix="/metrics")` ë¡œ ì„¤ì •ë¼ ìˆìœ¼ë¯€ë¡œ **ì „ì²´ ê²½ë¡œ**ëŠ” `http://<host>:8001/metrics/group/summary` ì…ë‹ˆë‹¤.
- **í´ë¼ì´ì–¸íŠ¸(ì˜ˆ: Spring, curl, Postman)ì—ì„œ**
  - `POST http://localhost:8001/metrics/group/summary` ë¡œ ì „ì†¡í–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
  - `Content-Type: application/json` í—¤ë”ì™€ ì˜¬ë°”ë¥¸ JSON ë°”ë””(`planIds`, `style`, `notes`, `mode`)ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
- **FastAPI ì„œë²„ê°€ ì˜¬ë°”ë¥¸ í¬íŠ¸(8001)ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€** í™•ì¸í•©ë‹ˆë‹¤. `uvicorn app.main:app --host 0.0.0.0 --port 8001` ë¡œ ì‹¤í–‰í–ˆëŠ”ì§€ ì ê²€í•©ë‹ˆë‹¤.
- **í”„ë¡ì‹œ/ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ**(NGINX ë“±)ë¥¼ ì‚¬ìš© ì¤‘ì´ë¼ë©´ ê²½ë¡œ ì¬ì‘ì„±(rule)ì´ `/metrics/group/summary` ë¡œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
- **ë¡œê·¸ í™•ì¸**: ì„œë²„ ë¡œê·¸ì— `INFO: 127.0.0.1:xxxxx - "POST /metrics/group/summary"` ì™€ ê°™ì€ ë¼ì¸ì´ ë³´ì´ë©´ ìš”ì²­ì´ ì •ìƒ ë„ì°©í•œ ê²ƒì…ë‹ˆë‹¤. ì—†ìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ ì¸¡ URLì´ ì˜ëª»ëœ ê²ƒì…ë‹ˆë‹¤.

ìœ„ í•­ëª©ì„ ì ê²€í•˜ë©´ ê·¸ë£¹ ìš”ì•½ APIê°€ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
